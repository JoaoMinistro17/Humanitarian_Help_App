<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GO HELP | Causas</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../plugins/fontawesome-free/css/all.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../dist/css/adminlte.min.css">
</head>
<body class="hold-transition sidebar-mini">
<div class="wrapper">
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="../index.html" class="nav-link">Home</a>
      </li>
    </ul>
  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="../index.html" class="brand-link">
      <img src="../dist/img/go_help.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
      <span class="brand-text font-weight-light">GO HELP</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">

      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <li class="nav-item">
            <a href="../index.html" class="nav-link">
              <i class="nav-icon fas fa-tachometer-alt"></i>
              <p>
                Página Inicial
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="../index.html" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Dashboard v1</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="../index2.html" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Dashboard v2</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="../index3.html" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Dashboard v3</p>
                </a>
              </li>
            </ul>
          </li>

          <!-- Iniciativas -->
          <li class="nav-item">
            <a href="iniciativas.html" class="nav-link"> 
              <i class="nav-icon fas fa-stream"></i>             
              <p>Iniciativas</p>
            </a>
          </li>

          <!-- Causas -->
          <li class="nav-item">
            <a href="causas.html" class="nav-link active">   
              <i class="nav-icon fas fa-pencil-alt"></i>
              <p>Causas</p>
            </a>
          </li>

          <!-- Profissionais -->
          <li class="nav-item">
            <a href="profissionais.html" class="nav-link"> 
              <i class="nav-icon fas fa-circle"></i>              
              <p>Profissionais</p>
            </a>
          </li>  

          <!-- Materiais -->
          <li class="nav-item">
            <a href="materiais.html" class="nav-link">  
              <i class="nav-icon fas fa-search"></i>                
              <p>Materiais</p>
            </a>
          </li> 

          <!-- Fotografias -->
          <li class="nav-item">
            <a href="fotografias.html" class="nav-link">
              <i class="nav-icon fas fa-image"></i>
              <p>Fotografias</p>
            </a>
          </li>

          <!-- Voluntários -->
          <li class="nav-item">
            <a href="voluntarios.html" class="nav-link"> 
              <i class="nav-icon fas fa-tree"></i>              
              <p>Voluntários</p>
            </a>
          </li> 

        </ul>
      </nav> 
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>Causas</h1>
          </div>
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="../index.html">Home</a></li>
              <li class="breadcrumb-item active">Causas</li>
            </ol>
          </div>
        </div>
      </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Causas</h3>
            <div class="card-tools">
              <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addCauseModal">
                Adicionar Causa
              </button>
            </div>
          </div>
          <div class="card-body">
            <table class="table table-bordered table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nome</th>
                  <th>Email</th>
                  <th>Data de Conclusão</th>
                  <th>Valor Recebido</th>
                  <th>Valor Angariado</th>
                  <th>Imagem</th>
                  <th>Descrição</th>
                  <th>Estado</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="causesTable"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Modal para adicionar causa -->
    <div class="modal fade" id="addCauseModal" tabindex="-1" aria-labelledby="addCauseModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addCauseModalLabel">Adicionar Causa</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="addCauseForm">
              <div class="form-group">
                <label for="nome">Nome</label>
                <input type="text" class="form-control" id="nome" name="nome" required>
              </div>
              <div class="form-group">
                <label for="email">Email</label>
                <input type="email" class="form-control" id="email" name="email" required>
              </div>
              <div class="form-group">
                <label for="data_conclusao">Data de Conclusão</label>
                <input type="date" class="form-control" id="data_conclusao" name="data_conclusao" required>
              </div>
              <div class="form-group">
                <label for="valor_recebido">Valor Recebido</label>
                <input type="number" class="form-control" id="valor_recebido" name="valor_recebido" required>
              </div>
              <div class="form-group">
                <label for="valor_angariado">Valor Angariado</label>
                <input type="number" class="form-control" id="valor_angariado" name="valor_angariado" required>
              </div>
              <div class="form-group">
                <label for="imagem">Imagem</label>
                <input type="file" class="form-control" id="imagem" name="imagem" accept="image/*" required>
              </div>
              <div class="form-group">
                <label for="descricao">Descrição</label>
                <textarea class="form-control" id="descricao" name="descricao" required></textarea>
              </div>
              <div class="form-group">
                <label for="estado">Estado</label>
                <select class="form-control" id="estado" name="estado" required>
                  <option value="pendente">Pendente</option>
                  <option value="emAndamento">Em andamento</option>
                  <option value="concluida">Concluída</option>
                </select>
              </div>
              <button type="submit" class="btn btn-primary">Salvar</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para editar causa -->
    <div class="modal fade" id="editCauseModal" tabindex="-1" aria-labelledby="editCauseModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editCauseModalLabel">Editar Causa</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="editCauseForm">
              <input type="hidden" id="edit-id">
              <div class="form-group">
                <label for="edit-nome">Nome</label>
                <input type="text" class="form-control" id="edit-nome" name="nome" required>
              </div>
              <div class="form-group">
                <label for="edit-email">Email</label>
                <input type="email" class="form-control" id="edit-email" name="email" required>
              </div>
              <div class="form-group">
                <label for="edit-data_conclusao">Data de Conclusão</label>
                <input type="date" class="form-control" id="edit-data_conclusao" name="data_conclusao" required>
              </div>
              <div class="form-group">
                <label for="edit-valor_recebido">Valor Recebido</label>
                <input type="number" class="form-control" id="edit-valor_recebido" name="valor_recebido" required>
              </div>
              <div class="form-group">
                <label for="edit-valor_angariado">Valor Angariado</label>
                <input type="number" class="form-control" id="edit-valor_angariado" name="valor_angariado" required>
              </div>
              <div class="form-group">
                <label for="edit-imagem">Imagem</label>
                <input type="file" class="form-control" id="edit-imagem" name="imagem" accept="image/*">
              </div>
              <div class="form-group">
                <label for="edit-descricao">Descrição</label>
                <textarea class="form-control" id="edit-descricao" name="descricao" required></textarea>
              </div>
              <div class="form-group">
                <label for="edit-estado">Estado</label>
                <select class="form-control" id="edit-estado" name="estado" required>
                  <option value="pendente">Pendente</option>
                  <option value="emAndamento">Em andamento</option>
                  <option value="concluida">Concluída</option>
                </select>
              </div>
              <button type="submit" class="btn btn-primary">Salvar</button>
            </form>
          </div>
        </div>
      </div>
    </div>

  </div>
  <!-- /.content-wrapper -->

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<!-- Bootstrap 4 -->
<script src="../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script src="../dist/js/adminlte.min.js"></script>

<script>
  $(document).ready(function() {
    let causes = JSON.parse(localStorage.getItem('causes')) || [];

    function displayCauses() {
      const causesTable = $('#causesTable');
      causesTable.empty();

      causes.forEach((cause, index) => {
        const row = `
          <tr>
            <td>${index + 1}</td>
            <td>${cause.nome}</td>
            <td>${cause.email}</td>
            <td>${cause.data_conclusao}</td>
            <td>${cause.valor_recebido}</td>
            <td>${cause.valor_angariado}</td>
            <td><img src="${cause.imagem}" alt="Imagem da causa" style="width: 50px; height: 50px;"></td>
            <td>${cause.descricao}</td>
            <td>${cause.estado}</td>
            <td>
              <button class="btn btn-info btn-sm edit-btn" data-index="${index}" data-toggle="modal" data-target="#editCauseModal">Editar</button>
              <button class="btn btn-danger btn-sm delete-btn" data-index="${index}">Excluir</button>
            </td>
          </tr>
        `;
        causesTable.append(row);
      });
    }

    function saveCause(cause) {
      causes.push(cause);
      localStorage.setItem('causes', JSON.stringify(causes));
      displayCauses();
    }

    function updateCause(index, updatedCause) {
      causes[index] = updatedCause;
      localStorage.setItem('causes', JSON.stringify(causes));
      displayCauses();
    }

    function deleteCause(index) {
      causes.splice(index, 1);
      localStorage.setItem('causes', JSON.stringify(causes));
      displayCauses();
    }

    function convertToBase64(file, callback) {
      const reader = new FileReader();
      reader.onloadend = () => callback(reader.result);
      reader.readAsDataURL(file);
    }

    $('#addCauseForm').submit(function(event) {
      event.preventDefault();

      const formData = new FormData(this);
      const cause = {
        nome: formData.get('nome'),
        email: formData.get('email'),
        data_conclusao: formData.get('data_conclusao'),
        valor_recebido: formData.get('valor_recebido'),
        valor_angariado: formData.get('valor_angariado'),
        descricao: formData.get('descricao'),
        estado: formData.get('estado')
      };

      const imageFile = formData.get('imagem');
      convertToBase64(imageFile, (base64Image) => {
        cause.imagem = base64Image;
        saveCause(cause);
        $('#addCauseModal').modal('hide');
        this.reset();
      });
    });

    $('#editCauseForm').submit(function(event) {
      event.preventDefault();

      const index = $('#edit-id').val();
      const formData = new FormData(this);
      const updatedCause = {
        nome: formData.get('nome'),
        email: formData.get('email'),
        data_conclusao: formData.get('data_conclusao'),
        valor_recebido: formData.get('valor_recebido'),
        valor_angariado: formData.get('valor_angariado'),
        descricao: formData.get('descricao'),
        estado: formData.get('estado')
      };

      const imageFile = formData.get('imagem');
      if (imageFile.size > 0) {
        convertToBase64(imageFile, (base64Image) => {
          updatedCause.imagem = base64Image;
          updateCause(index, updatedCause);
          $('#editCauseModal').modal('hide');
        });
      } else {
        updatedCause.imagem = causes[index].imagem;
        updateCause(index, updatedCause);
        $('#editCauseModal').modal('hide');
      }
    });

    $('#causesTable').on('click', '.edit-btn', function() {
      const index = $(this).data('index');
      const cause = causes[index];

      $('#edit-id').val(index);
      $('#edit-nome').val(cause.nome);
      $('#edit-email').val(cause.email);
      $('#edit-data_conclusao').val(cause.data_conclusao);
      $('#edit-valor_recebido').val(cause.valor_recebido);
      $('#edit-valor_angariado').val(cause.valor_angariado);
      $('#edit-descricao').val(cause.descricao);
      $('#edit-estado').val(cause.estado);
    });

    $('#causesTable').on('click', '.delete-btn', function() {
      const index = $(this).data('index');
      deleteCause(index);
    });

    displayCauses();
  });
</script>

</body>
</html>
